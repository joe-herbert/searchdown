let sdGlobalCount=0;function searchdown(e,t){let s=document.getElementById(e);if(!s)return console.error(`No element found for searchdown with id ${e}`),!1;s.classList.add("searchdown"),t?(void 0!==t.value&&Array.isArray(t.values)||(t.values=[]),void 0!==t.sort&&"ASC"!==t.sort&&"DESC"!==t.sort&&(t.sort=void 0),(void 0===t.limit||isNaN(t.limit))&&(t.limit=0),(void 0===t.multiple||"boolean"!=typeof t.multiple)&&(t.multiple=!1),(void 0===t.addValues||"boolean"!=typeof t.addValues)&&(t.addValues=!0),(void 0===t.saveEntered||"boolean"!=typeof t.saveEntered)&&(t.saveEntered=!0),(void 0===t.hideEntered||"boolean"!=typeof t.hideEntered)&&(t.hideEntered=!0),(void 0===t.allowDuplicates||"boolean"!=typeof t.allowDuplicates)&&(t.allowDuplicates=!1),(void 0===t.caseSensitive||"boolean"!=typeof t.caseSensitive)&&(t.caseSensitive=!1),void 0===t.placeholder&&(t.placeholder="Search"),(void 0===t.maxHeight||isNaN(t.maxHeight))&&(t.maxHeight=600),(void 0===t.inputName||""===t.inputName)&&(t.inputName="sd"+sdGlobalCount++)):t={values:[],sort:void 0,limit:0,multiple:!1,addValues:!0,saveEntered:!0,hideEntered:!0,allowDuplicates:!1,caseSensitive:!1,placeholder:"Search",maxHeight:600,inputName:"sd"+sdGlobalCount++},t.baseBackColor&&s.style.setProperty("--sdBackBase",t.baseBackColor),t.selectedBackColor&&s.style.setProperty("--sdBackSelected",t.selectedBackColor),t.hoverBackColor&&s.style.setProperty("--sdBackHover",t.hoverBackColor),t.baseTextColor&&s.style.setProperty("--sdTextBase",t.baseTextColor),t.selectedTextColor&&s.style.setProperty("--sdTextSelected",t.selectedTextColor),t.hoverTextColor&&s.style.setProperty("--sdTextHover",t.hoverTextColor);let d=document.createElement("div");d.classList.add("sdInputWrapper");let l=document.createElement("input");l.placeholder=t.placeholder,l.classList.add("sdInput"),l.name=t.inputName+"LastInput";let o;t.multiple?(o=document.createElement("select")).multiple=!0:(o=document.createElement("input")).type="text",o.classList.add("sdHide"),o.classList.add("sdEnteredInput"),o.name=t.inputName;let r=document.createElement("div");r.classList.add("sdDropdownWrapper"),r.classList.add("sdHide");let a=document.createElement("ul");a.classList.add("sdDropdown");let n=document.createElement("div");if(n.classList.add("sdEnteredWrapper"),t.addValues){let i=document.createElement("li");i.classList.add("sdAddOption"),i.addEventListener("click",e=>{let s=e.target.closest(".searchdown"),d=s.querySelector(".sdInput").value;""!==d&&(sdAddEntered(t,s,d,!0),t.saveEntered&&t.values.push(d))}),a.appendChild(i)}l.addEventListener("keydown",e=>{if(e.isComposing||229===e.keyCode||"Unidentified"===e.key||"Dead"===e.key)return;let s=e.currentTarget,d=/^[a-zA-Z0-9-_ ]$/.test(e.key),l=s.value+(d?e.key:"");"Backspace"===e.key&&""!==l&&(l=l.substring(0,l.length-1));let o=s.closest(".searchdown");if("Enter"===e.key){let r=o.querySelector(".sdDropdown .sdSelected"),a=r.innerHTML;r.classList.contains("sdAddOption")&&(t.saveEntered&&""!==l&&t.values.push(l),a=l),""===l&&r.classList.contains("sdAddOption")||(sdAddEntered(t,o,a,!0),sdSearchAndShowDropdown(t,s,"")),e.preventDefault()}else if("Down"===e.key||"ArrowDown"===e.key){let n=o.querySelector(".sdDropdown .sdSelected"),i=n.nextElementSibling;i&&(n.classList.remove("sdSelected"),i.classList.add("sdSelected"),e.preventDefault())}else if("Up"===e.key||"ArrowUp"===e.key){let c=o.querySelector(".sdDropdown .sdSelected"),p=c.previousElementSibling;p&&(c.classList.remove("sdSelected"),p.classList.add("sdSelected"),e.preventDefault())}else if("Backspace"===e.key&&""===s.value){let u=o.querySelector(".sdEntered:last-of-type");u&&u.remove();let v=o.querySelector(".sdEnteredInput");t.multiple?v.querySelectorAll("option").forEach(e=>{e.value===u.innerHTML&&e.remove()}):v.value="",sdSearchAndShowDropdown(t,s,"")}else"Tab"===e.key?sdLoseFocus():"Escape"===e.key?(sdLoseFocus(),s.blur()):(d||"Backspace"===e.key)&&sdSearchAndShowDropdown(t,s,l);sdResizeInput(s,e.key)}),l.addEventListener("focus",e=>{let s=e.currentTarget,d=s.value;sdSearchAndShowDropdown(t,s,d)}),d.appendChild(n),d.appendChild(l),s.appendChild(d),r.appendChild(a),s.appendChild(r),s.appendChild(o),sdResizeInput(l,"")}function sdResizeInput(e,t){if(e.style.width=0,(""===e.value||1===e.value.length&&"Backspace"===t)&&""!==e.placeholder){let s=document.createElement("span");s.innerHTML=e.placeholder,e.closest(".searchdown").appendChild(s),e.style.width=s.scrollWidth+"px",s.remove()}else e.style.width=e.scrollWidth+12+"px"}function sdLoseFocus(e){e?(document.querySelectorAll(".searchdown").forEach(t=>{t.isSameNode(e)||t.querySelector(".sdDropdownWrapper").classList.add("sdHide")}),e.querySelector(".sdInput").focus()):document.querySelectorAll(".searchdown .sdDropdownWrapper").forEach(e=>{e.classList.add("sdHide")})}function sdAddEntered(e,t,s,d){let l=t.querySelector(".sdEnteredWrapper"),o=l.querySelector(".sdEntered");if(!e.multiple&&o)o.innerHTML=s;else if(e.allowDuplicates||!sdEnteredContainsValue(l,s,e.caseSensitive)){let r=document.createElement("span");r.classList.add("sdEntered"),r.innerHTML=s,r.addEventListener("click",s=>{s.target.remove();let d=t.querySelector(".sdEnteredInput");e.multiple?d.querySelectorAll("option").forEach(e=>{e.value===lastEntered.innerHTML&&e.remove()}):d.value=""}),l.appendChild(r)}let a=t.querySelector(".sdInput");d&&(a.value=""),sdResizeInput(a,"");let n=t.querySelector(".sdEnteredInput");if(e.multiple){let i=document.createElement("option");i.value=s,i.selected=!0,n.appendChild(i)}else n.value=s}function sdSearchAndShowDropdown(e,t,s){if(0!==e.values.length||e.addValues){let d=t.closest(".searchdown"),l=d.querySelector(".sdEnteredWrapper"),o=e.values.filter(t=>!(e.hideEntered&&sdEnteredContainsValue(l,t,e.caseSensitive))&&(e.caseSensitive?t.includes(s):t.toLowerCase().includes(s.toLowerCase())));"ASC"===e.sort?o.sort():"DESC"===e.sort&&o.sort().reverse(),0!==e.limit&&(o=o.slice(0,e.limit));let r=d.querySelector(".sdDropdown");r.querySelectorAll("li.sdOption:not(.sdAddOption)").forEach(e=>{e.remove()});let a=!0;for(let n of o){let i=document.createElement("li");i.classList.add("sdOption"),a&&(i.classList.add("sdSelected"),a=!1),i.innerHTML=n,i.addEventListener("click",t=>{""!==n&&sdAddEntered(e,t.target.closest(".searchdown"),t.target.innerHTML,!1)}),r.appendChild(i)}let c=r.querySelector("li.sdAddOption");if(c&&(0===o.length?c.classList.add("sdSelected"):c.classList.remove("sdSelected")),e.values.includes(s))c&&c.classList.add("sdHide");else if(c&&(r.appendChild(c),c.classList.remove("sdHide")),e.addValues){let p=`Press Enter to add <b>"${s}"</b>`;""===s&&(p="Type to enter a new value"),r.querySelector("li.sdAddOption").classList.remove("sdHide"),r.querySelector("li.sdAddOption").innerHTML=p}let u=d.querySelector(".sdDropdownWrapper");document.querySelector("body").getBoundingClientRect().bottom-d.getBoundingClientRect().bottom<80?(u.classList.add("sdTop"),u.style.maxHeight=Math.min(d.getBoundingClientRect().top-document.querySelector("body").getBoundingClientRect().top,e.maxHeight)+"px"):u.style.maxHeight=Math.min(document.querySelector("body").getBoundingClientRect().bottom-d.getBoundingClientRect().bottom,e.maxHeight)+"px",u.style.width=d.getBoundingClientRect().width+"px",u.classList.remove("sdHide")}}function sdEnteredContainsValue(e,t,s){let d=e.getElementsByClassName("sdEntered");for(let l of d)if(s){if(l.innerHTML===t)return!0}else if(l.innerHTML.toLowerCase()===t.toLowerCase())return!0;return!1}function sdGetSelectValues(e){for(var t,s=[],d=e&&e.options,l=0;l<d.length;l++)(t=d[l]).selected&&s.push(t.value||t.text);return s}document.addEventListener("click",e=>{sdLoseFocus(e.target.closest(".searchdown")),e.stopPropagation()});