let sdGlobalCount=0;function searchdown(e,t){let s=document.getElementById(e);if(!s)return console.error(`No element found for searchdown with id ${e}`),!1;s.classList.add("searchdown"),t?(void 0!==t.values&&Array.isArray(t.values)||(t.values=[]),void 0!==t.sort&&"ASC"!==t.sort&&"DESC"!==t.sort&&(t.sort=void 0),(void 0===t.limit||isNaN(t.limit))&&(t.limit=0),(void 0===t.multiple||"boolean"!=typeof t.multiple)&&(t.multiple=!1),(void 0===t.addValues||"boolean"!=typeof t.addValues)&&(t.addValues=!0),(void 0===t.saveEntered||"boolean"!=typeof t.saveEntered)&&(t.saveEntered=!0),(void 0===t.hideEntered||"boolean"!=typeof t.hideEntered)&&(t.hideEntered=!0),(void 0===t.allowDuplicates||"boolean"!=typeof t.allowDuplicates)&&(t.allowDuplicates=!1),(void 0===t.caseSensitive||"boolean"!=typeof t.caseSensitive)&&(t.caseSensitive=!1),void 0===t.placeholder&&(t.placeholder="Search"),(void 0===t.maxHeight||isNaN(t.maxHeight))&&(t.maxHeight=600),(void 0===t.inputName||""===t.inputName)&&(t.inputName="sd"+sdGlobalCount++),void 0!==t.initialValues&&Array.isArray(t.initialValues)||(t.initialValues=[]),(void 0===t.simpleInput||"boolean"!=typeof t.simpleInput)&&(t.simpleInput=!1)):t={values:[],sort:void 0,limit:0,multiple:!1,addValues:!0,saveEntered:!0,hideEntered:!0,allowDuplicates:!1,caseSensitive:!1,placeholder:"Search",maxHeight:600,inputName:"sd"+sdGlobalCount++,initialValues:[],simpleInput:!1},t.baseBackColor&&s.style.setProperty("--sdBackBase",t.baseBackColor),t.selectedBackColor&&s.style.setProperty("--sdBackSelected",t.selectedBackColor),t.hoverBackColor&&s.style.setProperty("--sdBackHover",t.hoverBackColor),t.baseTextColor&&s.style.setProperty("--sdTextBase",t.baseTextColor),t.selectedTextColor&&s.style.setProperty("--sdTextSelected",t.selectedTextColor),t.hoverTextColor&&s.style.setProperty("--sdTextHover",t.hoverTextColor);let l=document.createElement("div");l.classList.add("sdInputWrapper");let d=document.createElement("input");d.placeholder=t.placeholder,d.classList.add("sdInput"),d.name=t.inputName+"LastInput";let a;t.multiple?(a=document.createElement("select")).multiple=!0:(a=document.createElement("input")).type="text",a.classList.add("sdHide"),a.classList.add("sdEnteredInput"),a.name=t.inputName,a.id="sdInput-"+t.inputName;let r=document.createElement("div");r.classList.add("sdDropdownWrapper"),r.classList.add("sdHide");let o=document.createElement("ul");o.classList.add("sdDropdown");let n=document.createElement("div");if(n.classList.add("sdEnteredWrapper"),t.addValues&&!t.simpleInput){let i=document.createElement("li");i.classList.add("sdAddOption"),i.addEventListener("click",e=>{let s=e.target.closest(".searchdown"),l=s.querySelector(".sdInput").value;""!==l&&(sdAddEntered(t,s,l,!0),t.saveEntered&&t.values.push(l))}),o.appendChild(i)}d.addEventListener("keydown",e=>{if(e.isComposing||229===e.keyCode||"Unidentified"===e.key||"Dead"===e.key)return;let s=e.currentTarget,l=/^[a-zA-Z0-9-_ ]$/.test(e.key),d=s.value+(l?e.key:"");"Backspace"===e.key&&""!==d&&(d=d.substring(0,d.length-1));let a=s.closest(".searchdown");if("Enter"===e.key){let r=a.querySelector(".sdDropdown .sdSelected"),o=r.innerHTML;r.classList.contains("sdAddOption")&&(t.saveEntered&&""!==d&&t.values.push(d),o=d),""===d&&r.classList.contains("sdAddOption")||(sdAddEntered(t,a,o,!0),sdSearchAndShowDropdown(t,s,"")),e.preventDefault()}else if("Down"===e.key||"ArrowDown"===e.key){let n=a.querySelector(".sdDropdown .sdSelected"),i=n.nextElementSibling;i&&(n.classList.remove("sdSelected"),i.classList.add("sdSelected"),e.preventDefault())}else if("Up"===e.key||"ArrowUp"===e.key){let c=a.querySelector(".sdDropdown .sdSelected"),p=c.previousElementSibling;p&&(c.classList.remove("sdSelected"),p.classList.add("sdSelected"),e.preventDefault())}else if("Backspace"===e.key&&""===s.value){let u=a.querySelector(".sdEntered:last-of-type");u&&u.remove();let m=a.querySelector(".sdEnteredInput");t.multiple?m.querySelectorAll("option").forEach(e=>{e.value===u.innerHTML&&e.remove()}):m.value="",sdSearchAndShowDropdown(t,s,"")}else"Tab"===e.key?sdLoseFocus():"Escape"===e.key?(sdLoseFocus(),s.blur()):(l||"Backspace"===e.key)&&sdSearchAndShowDropdown(t,s,d);sdResizeInput(s,e.key,t.simpleInput)}),d.addEventListener("focus",e=>{let s=e.currentTarget,l=s.value;sdSearchAndShowDropdown(t,s,l)}),l.appendChild(n),l.appendChild(d),s.appendChild(l),r.appendChild(o),s.appendChild(r),s.appendChild(a),s.dataset.options=JSON.stringify(t);var c=getComputedStyle(l);if(d.style.width=l.offsetWidth-(parseFloat(c.paddingLeft)+parseFloat(c.paddingRight))+"px",t.multiple)for(let p of t.initialValues)sdAddEntered(t,s,p,!0);else t.initialValues[0]&&sdAddEntered(t,s,t.initialValues[0],!0)}function sdResizeInput(e,t,s){if(s)e.style.width="100%";else if(e.style.width=0,(""===e.value||1===e.value.length&&"Backspace"===t)&&""!==e.placeholder){let l=document.createElement("span");l.innerHTML=e.placeholder,document.querySelector("body").appendChild(l),e.style.width=l.scrollWidth+"px",l.remove()}else e.style.width=e.scrollWidth+12+"px"}function sdLoseFocus(e){e?(document.querySelectorAll(".searchdown").forEach(t=>{t.isSameNode(e)||t.querySelector(".sdDropdownWrapper").classList.add("sdHide")}),e.querySelector(".sdInput").focus()):document.querySelectorAll(".searchdown .sdDropdownWrapper").forEach(e=>{e.classList.add("sdHide")})}function sdAddEntered(e,t,s,l){let d=t.querySelector(".sdEnteredWrapper"),a=d.querySelector(".sdEntered");if(!e.multiple&&a)a.innerHTML=s;else if(!e.simpleInput&&(e.allowDuplicates||!sdEnteredContainsValue(d,s,e.caseSensitive))){let r=document.createElement("span");r.classList.add("sdEntered"),r.innerHTML=s,r.addEventListener("click",s=>{let l=s.target.innerHTML;s.target.remove();let d=t.querySelector(".sdEnteredInput");e.multiple?d.querySelectorAll("option").forEach(e=>{e.value===l&&e.remove()}):d.value=""}),d.appendChild(r)}let o=t.querySelector(".sdInput");l&&(o.value=""),sdResizeInput(o,"",e.simpleInput);let n=t.querySelector(".sdEnteredInput");if(e.multiple){let i=document.createElement("option");i.value=s,i.selected=!0,n.appendChild(i)}else n.value=s}function sdSearchAndShowDropdown(e,t,s){if(0!==e.values.length||e.addValues){let l=t.closest(".searchdown"),d=l.querySelector(".sdEnteredWrapper"),a=e.values.filter(t=>!(e.hideEntered&&sdEnteredContainsValue(d,t,e.caseSensitive))&&(e.caseSensitive?t.includes(s):t.toLowerCase().includes(s.toLowerCase())));"ASC"===e.sort?a.sort():"DESC"===e.sort&&a.sort().reverse(),0!==e.limit&&(a=a.slice(0,e.limit));let r=l.querySelector(".sdDropdown");r.querySelectorAll("li.sdOption:not(.sdAddOption)").forEach(e=>{e.remove()});let o=!0;for(let n of a){let i=document.createElement("li");i.classList.add("sdOption"),o&&(i.classList.add("sdSelected"),o=!1),i.innerHTML=n,i.addEventListener("click",t=>{""!==n&&sdAddEntered(e,t.target.closest(".searchdown"),t.target.innerHTML,!1)}),r.appendChild(i)}let c=r.querySelector("li.sdAddOption");if(c&&(0===a.length?c.classList.add("sdSelected"):c.classList.remove("sdSelected")),e.values.includes(s))c&&c.classList.add("sdHide");else if(c&&(r.appendChild(c),c.classList.remove("sdHide")),e.addValues){let p=`Press Enter to add <b>"${s}"</b>`;""===s&&(p="Type to enter a new value"),r.querySelector("li.sdAddOption").classList.remove("sdHide"),r.querySelector("li.sdAddOption").innerHTML=p}let u=l.querySelector(".sdDropdownWrapper");document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom<80?(u.classList.add("sdTop"),u.style.maxHeight=Math.min(l.getBoundingClientRect().top-document.querySelector("body").getBoundingClientRect().top,e.maxHeight)+"px"):u.style.maxHeight=Math.min(document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom,e.maxHeight)+"px",u.style.width=l.getBoundingClientRect().width+"px",u.classList.remove("sdHide")}}function sdEnteredContainsValue(e,t,s){let l=e.getElementsByClassName("sdEntered");for(let d of l)if(s){if(d.innerHTML===t)return!0}else if(d.innerHTML.toLowerCase()===t.toLowerCase())return!0;return!1}function sdGetValue(e,t){if("string"==typeof e&&!(e=document.getElementById(e)))return!1;if(JSON.parse(e.closest(".searchdown").dataset.options).simpleInput&&(t=!0),"SELECT"===e.tagName){let s=[],l=e&&e.options,d;for(let a=0;a<l.length;a++)(d=l[a]).selected&&s.push(d.value||d.text);if(t){let r=document.getElementsByName(e.name+"LastInput")[0];r&&r.value&&s.push(r.value)}return s}if(e.tagName){if(e.value)return e.value;if(t){let o=document.getElementsByName(e.name+"LastInput")[0];if(o&&o.value)return o.value}}return!1}function sdSetValue(e,t){if("string"==typeof e&&!(e=document.getElementById(e)))return!1;"string"==typeof t&&(t=[t]);let s=e.closest(".searchdown");if(s.querySelector(".sdEnteredWrapper").innerHTML="","SELECT"===e.tagName){let l=e.options;for(let d=0;d<l.length;d++)l[d].remove()}else e.tagName&&(e.value="");return t.forEach(e=>{sdAddEntered(JSON.parse(s.dataset.options),s,e,!1)}),!1}document.addEventListener("click",e=>{sdLoseFocus(e.target.closest(".searchdown")),e.stopPropagation()});