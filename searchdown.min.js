let sdGlobalCount=0;function searchdown(e,t){let s=document.getElementById(e);if(!s)return console.error(`No element found for searchdown with id ${e}`),!1;s.classList.add("searchdown"),t?(void 0!==t.values&&Array.isArray(t.values)||(t.values=[]),void 0!==t.sort&&"ASC"!==t.sort&&"DESC"!==t.sort&&(t.sort=void 0),(void 0===t.limit||isNaN(t.limit))&&(t.limit=0),(void 0===t.multiple||"boolean"!=typeof t.multiple)&&(t.multiple=!1),(void 0===t.addValues||"boolean"!=typeof t.addValues)&&(t.addValues=!0),(void 0===t.saveEntered||"boolean"!=typeof t.saveEntered)&&(t.saveEntered=!0),(void 0===t.hideEntered||"boolean"!=typeof t.hideEntered)&&(t.hideEntered=!0),(void 0===t.allowDuplicates||"boolean"!=typeof t.allowDuplicates)&&(t.allowDuplicates=!1),(void 0===t.caseSensitive||"boolean"!=typeof t.caseSensitive)&&(t.caseSensitive=!1),void 0===t.placeholder&&(t.placeholder="Search"),(void 0===t.maxHeight||isNaN(t.maxHeight))&&(t.maxHeight=600),(void 0===t.inputName||""===t.inputName)&&(t.inputName="sd"+sdGlobalCount++),void 0!==t.initialValues&&Array.isArray(t.initialValues)||(t.initialValues=[])):t={values:[],sort:void 0,limit:0,multiple:!1,addValues:!0,saveEntered:!0,hideEntered:!0,allowDuplicates:!1,caseSensitive:!1,placeholder:"Search",maxHeight:600,inputName:"sd"+sdGlobalCount++,initialValues:[]},t.baseBackColor&&s.style.setProperty("--sdBackBase",t.baseBackColor),t.selectedBackColor&&s.style.setProperty("--sdBackSelected",t.selectedBackColor),t.hoverBackColor&&s.style.setProperty("--sdBackHover",t.hoverBackColor),t.baseTextColor&&s.style.setProperty("--sdTextBase",t.baseTextColor),t.selectedTextColor&&s.style.setProperty("--sdTextSelected",t.selectedTextColor),t.hoverTextColor&&s.style.setProperty("--sdTextHover",t.hoverTextColor);let l=document.createElement("div");l.classList.add("sdInputWrapper");let d=document.createElement("input");d.placeholder=t.placeholder,d.classList.add("sdInput"),d.name=t.inputName+"LastInput";let r;t.multiple?(r=document.createElement("select")).multiple=!0:(r=document.createElement("input")).type="text",r.classList.add("sdHide"),r.classList.add("sdEnteredInput"),r.name=t.inputName,r.id="sdInput-"+t.inputName;let a=document.createElement("div");a.classList.add("sdDropdownWrapper"),a.classList.add("sdHide");let o=document.createElement("ul");o.classList.add("sdDropdown");let n=document.createElement("div");if(n.classList.add("sdEnteredWrapper"),t.addValues){let i=document.createElement("li");i.classList.add("sdAddOption"),i.addEventListener("click",e=>{let s=e.target.closest(".searchdown"),l=s.querySelector(".sdInput").value;""!==l&&(sdAddEntered(t,s,l,!0),t.saveEntered&&t.values.push(l))}),o.appendChild(i)}if(d.addEventListener("keydown",e=>{if(e.isComposing||229===e.keyCode||"Unidentified"===e.key||"Dead"===e.key)return;let s=e.currentTarget,l=/^[a-zA-Z0-9-_ ]$/.test(e.key),d=s.value+(l?e.key:"");"Backspace"===e.key&&""!==d&&(d=d.substring(0,d.length-1));let r=s.closest(".searchdown");if("Enter"===e.key){let a=r.querySelector(".sdDropdown .sdSelected"),o=a.innerHTML;a.classList.contains("sdAddOption")&&(t.saveEntered&&""!==d&&t.values.push(d),o=d),""===d&&a.classList.contains("sdAddOption")||(sdAddEntered(t,r,o,!0),sdSearchAndShowDropdown(t,s,"")),e.preventDefault()}else if("Down"===e.key||"ArrowDown"===e.key){let n=r.querySelector(".sdDropdown .sdSelected"),i=n.nextElementSibling;i&&(n.classList.remove("sdSelected"),i.classList.add("sdSelected"),e.preventDefault())}else if("Up"===e.key||"ArrowUp"===e.key){let c=r.querySelector(".sdDropdown .sdSelected"),u=c.previousElementSibling;u&&(c.classList.remove("sdSelected"),u.classList.add("sdSelected"),e.preventDefault())}else if("Backspace"===e.key&&""===s.value){let p=r.querySelector(".sdEntered:last-of-type");p&&p.remove();let v=r.querySelector(".sdEnteredInput");t.multiple?v.querySelectorAll("option").forEach(e=>{e.value===p.innerHTML&&e.remove()}):v.value="",sdSearchAndShowDropdown(t,s,"")}else"Tab"===e.key?sdLoseFocus():"Escape"===e.key?(sdLoseFocus(),s.blur()):(l||"Backspace"===e.key)&&sdSearchAndShowDropdown(t,s,d);sdResizeInput(s,e.key)}),d.addEventListener("focus",e=>{let s=e.currentTarget,l=s.value;sdSearchAndShowDropdown(t,s,l)}),l.appendChild(n),l.appendChild(d),s.appendChild(l),a.appendChild(o),s.appendChild(a),s.appendChild(r),sdResizeInput(d,""),t.multiple)for(let c of t.initialValues)sdAddEntered(t,s,c,!0);else sdAddEntered(t,s,t.initialValues[0],!0)}function sdResizeInput(e,t){if(e.style.width=0,(""===e.value||1===e.value.length&&"Backspace"===t)&&""!==e.placeholder){let s=document.createElement("span");s.innerHTML=e.placeholder,document.querySelector("body").appendChild(s),e.style.width=s.scrollWidth+"px",s.remove()}else e.style.width=e.scrollWidth+12+"px"}function sdLoseFocus(e){e?(document.querySelectorAll(".searchdown").forEach(t=>{t.isSameNode(e)||t.querySelector(".sdDropdownWrapper").classList.add("sdHide")}),e.querySelector(".sdInput").focus()):document.querySelectorAll(".searchdown .sdDropdownWrapper").forEach(e=>{e.classList.add("sdHide")})}function sdAddEntered(e,t,s,l){let d=t.querySelector(".sdEnteredWrapper"),r=d.querySelector(".sdEntered");if(!e.multiple&&r)r.innerHTML=s;else if(e.allowDuplicates||!sdEnteredContainsValue(d,s,e.caseSensitive)){let a=document.createElement("span");a.classList.add("sdEntered"),a.innerHTML=s,a.addEventListener("click",s=>{s.target.remove();let l=t.querySelector(".sdEnteredInput");e.multiple?l.querySelectorAll("option").forEach(e=>{e.value===lastEntered.innerHTML&&e.remove()}):l.value=""}),d.appendChild(a)}let o=t.querySelector(".sdInput");l&&(o.value=""),sdResizeInput(o,"");let n=t.querySelector(".sdEnteredInput");if(e.multiple){let i=document.createElement("option");i.value=s,i.selected=!0,n.appendChild(i)}else n.value=s}function sdSearchAndShowDropdown(e,t,s){if(0!==e.values.length||e.addValues){let l=t.closest(".searchdown"),d=l.querySelector(".sdEnteredWrapper"),r=e.values.filter(t=>!(e.hideEntered&&sdEnteredContainsValue(d,t,e.caseSensitive))&&(e.caseSensitive?t.includes(s):t.toLowerCase().includes(s.toLowerCase())));"ASC"===e.sort?r.sort():"DESC"===e.sort&&r.sort().reverse(),0!==e.limit&&(r=r.slice(0,e.limit));let a=l.querySelector(".sdDropdown");a.querySelectorAll("li.sdOption:not(.sdAddOption)").forEach(e=>{e.remove()});let o=!0;for(let n of r){let i=document.createElement("li");i.classList.add("sdOption"),o&&(i.classList.add("sdSelected"),o=!1),i.innerHTML=n,i.addEventListener("click",t=>{""!==n&&sdAddEntered(e,t.target.closest(".searchdown"),t.target.innerHTML,!1)}),a.appendChild(i)}let c=a.querySelector("li.sdAddOption");if(c&&(0===r.length?c.classList.add("sdSelected"):c.classList.remove("sdSelected")),e.values.includes(s))c&&c.classList.add("sdHide");else if(c&&(a.appendChild(c),c.classList.remove("sdHide")),e.addValues){let u=`Press Enter to add <b>"${s}"</b>`;""===s&&(u="Type to enter a new value"),a.querySelector("li.sdAddOption").classList.remove("sdHide"),a.querySelector("li.sdAddOption").innerHTML=u}let p=l.querySelector(".sdDropdownWrapper");document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom<80?(p.classList.add("sdTop"),p.style.maxHeight=Math.min(l.getBoundingClientRect().top-document.querySelector("body").getBoundingClientRect().top,e.maxHeight)+"px"):p.style.maxHeight=Math.min(document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom,e.maxHeight)+"px",p.style.width=l.getBoundingClientRect().width+"px",p.classList.remove("sdHide")}}function sdEnteredContainsValue(e,t,s){let l=e.getElementsByClassName("sdEntered");for(let d of l)if(s){if(d.innerHTML===t)return!0}else if(d.innerHTML.toLowerCase()===t.toLowerCase())return!0;return!1}function sdGetValue(e,t){if("string"==typeof e&&!(e=document.getElementById(e)))return!1;if("SELECT"===e.tagName){for(var s,l=[],d=e&&e.options,r=0;r<d.length;r++)(s=d[r]).selected&&l.push(s.value||s.text);if(t){let a=document.getElementsByName(e.name+"LastInput")[0];a&&a.value&&l.push(a.value)}return l}if(e.tagName){if(e.value)return e.value;if(t){let o=document.getElementsByName(e.name+"LastInput")[0];if(o&&o.value)return o.value}}return!1}document.addEventListener("click",e=>{sdLoseFocus(e.target.closest(".searchdown")),e.stopPropagation()});