let sdGlobalCount=0;function searchdown(e,t){let d=document.getElementById(e);if(!d)return console.error(`No element found for searchdown with id ${e}`),!1;if(d.classList.add("searchdown"),t?(Array.isArray(t.values)||(t.values=[]),void 0!==t.sort&&"ASC"!==t.sort&&"DESC"!==t.sort&&(t.sort=void 0),(void 0===t.limit||isNaN(t.limit))&&(t.limit=0),(void 0===t.multiple||"boolean"!=typeof t.multiple)&&(t.multiple=!1),(void 0===t.addValues||"boolean"!=typeof t.addValues)&&(t.addValues=!0),(void 0===t.saveEntered||"boolean"!=typeof t.saveEntered)&&(t.saveEntered=!0),(void 0===t.hideEntered||"boolean"!=typeof t.hideEntered)&&(t.hideEntered=!0),(void 0===t.caseSensitive||"boolean"!=typeof t.caseSensitive)&&(t.caseSensitive=!1),void 0===t.placeholder&&(t.placeholder="Search"),(void 0===t.maxHeight||isNaN(t.maxHeight))&&(t.maxHeight=600),(void 0===t.inputName||""===t.inputName)&&(t.inputName="sd"+sdGlobalCount++)):t={values:[],sort:void 0,limit:0,multiple:!1,addValues:!0,saveEntered:!0,hideEntered:!0,caseSensitive:!1,placeholder:"Search",maxHeight:600,inputName:"sd"+sdGlobalCount++},!t.values&&!t.addValues)return console.error(`No valid values provided for searchdown with id ${e}`),!1;t.baseBackColor&&d.style.setProperty("--sdBackBase",t.baseBackColor),t.selectedBackColor&&d.style.setProperty("--sdBackSelected",t.selectedBackColor),t.hoverBackColor&&d.style.setProperty("--sdBackHover",t.hoverBackColor),t.baseTextColor&&d.style.setProperty("--sdTextBase",t.baseTextColor),t.selectedTextColor&&d.style.setProperty("--sdTextSelected",t.selectedTextColor),t.hoverTextColor&&d.style.setProperty("--sdTextHover",t.hoverTextColor);let s=document.createElement("div");s.classList.add("sdInputWrapper");let l=document.createElement("input");l.placeholder=t.placeholder,l.classList.add("sdInput"),l.name=t.inputName+"LastInput";let r;t.multiple?(r=document.createElement("select")).multiple=!0:(r=document.createElement("input")).type="text",r.classList.add("sdHide"),r.classList.add("sdEnteredInput"),r.name=t.inputName;let o=document.createElement("div");o.classList.add("sdDropdownWrapper"),o.classList.add("sdHide");let a=document.createElement("ul");a.classList.add("sdDropdown");let n=document.createElement("div");if(n.classList.add("sdEnteredWrapper"),t.addValues){let i=document.createElement("li");i.classList.add("sdAddOption"),i.addEventListener("click",e=>{let d=e.target.closest(".searchdown"),s=d.querySelector(".sdInput").value;""!==s&&(sdAddEntered(t,d,s,!0),t.saveEntered&&t.values.push(s))}),a.appendChild(i)}l.addEventListener("keydown",e=>{if(e.isComposing||229===e.keyCode||"Unidentified"===e.key||"Dead"===e.key)return;let d=e.currentTarget,s=/^[a-zA-Z0-9-_ ]$/.test(e.key),l=d.value+(s?e.key:"");"Backspace"===e.key&&""!==l&&(l=l.substring(0,l.length-1));let r=d.closest(".searchdown");if("Enter"===e.key){let o=r.querySelector(".sdDropdown .sdSelected"),a=o.innerHTML;o.classList.contains("sdAddOption")&&(t.saveEntered&&""!==l&&t.values.push(l),a=l),""===l&&o.classList.contains("sdAddOption")||(sdAddEntered(t,r,a,!0),sdSearchAndShowDropdown(t,d,"")),e.preventDefault()}else if("Down"===e.key||"ArrowDown"===e.key){let n=r.querySelector(".sdDropdown .sdSelected"),i=n.nextElementSibling;i&&(n.classList.remove("sdSelected"),i.classList.add("sdSelected"),e.preventDefault())}else if("Up"===e.key||"ArrowUp"===e.key){let c=r.querySelector(".sdDropdown .sdSelected"),p=c.previousElementSibling;p&&(c.classList.remove("sdSelected"),p.classList.add("sdSelected"),e.preventDefault())}else if("Backspace"===e.key&&""===d.value){let u=r.querySelector(".sdEntered:last-of-type");u&&u.remove();let v=r.querySelector(".sdEnteredInput");t.multiple?v.querySelectorAll("option").forEach(e=>{e.value===u.innerHTML&&e.remove()}):v.value="",sdSearchAndShowDropdown(t,d,"")}else"Tab"===e.key?sdLoseFocus():"Escape"===e.key?(sdLoseFocus(),d.blur()):(s||"Backspace"===e.key)&&sdSearchAndShowDropdown(t,d,l);sdResizeInput(d,e.key)}),l.addEventListener("focus",e=>{let d=e.currentTarget,s=d.value;sdSearchAndShowDropdown(t,d,s);let l=d.closest(".searchdown"),r=l.querySelector(".sdDropdownWrapper");document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom<80?(r.classList.add("sdTop"),r.style.maxHeight=Math.min(l.getBoundingClientRect().top-document.querySelector("body").getBoundingClientRect().top,t.maxHeight)+"px"):r.style.maxHeight=Math.min(document.querySelector("body").getBoundingClientRect().bottom-l.getBoundingClientRect().bottom,t.maxHeight)+"px",r.classList.remove("sdHide")}),s.appendChild(n),s.appendChild(l),d.appendChild(s),o.appendChild(a),d.appendChild(o),d.appendChild(r),sdResizeInput(l,"")}function sdResizeInput(e,t){if(e.style.width=0,(""===e.value||1===e.value.length&&"Backspace"===t)&&""!==e.placeholder){let d=document.createElement("span");d.innerHTML=e.placeholder,e.closest(".searchdown").appendChild(d),e.style.width=d.scrollWidth+"px",d.remove()}else e.style.width=e.scrollWidth+12+"px"}function sdLoseFocus(e){e?(document.querySelectorAll(".searchdown").forEach(t=>{t.isSameNode(e)||t.querySelector(".sdDropdownWrapper").classList.add("sdHide")}),e.querySelector(".sdInput").focus()):document.querySelectorAll(".searchdown .sdDropdownWrapper").forEach(e=>{e.classList.add("sdHide")})}function sdAddEntered(e,t,d,s){let l=t.querySelector(".sdEnteredWrapper"),r=l.querySelector(".sdEntered");if(!e.multiple&&r)r.innerHTML=d;else{let o=document.createElement("span");o.classList.add("sdEntered"),o.innerHTML=d,o.addEventListener("click",d=>{d.target.remove();let s=t.querySelector(".sdEnteredInput");e.multiple?s.querySelectorAll("option").forEach(e=>{e.value===lastEntered.innerHTML&&e.remove()}):s.value=""}),l.appendChild(o)}let a=t.querySelector(".sdInput");s&&(a.value=""),sdResizeInput(a,"");let n=t.querySelector(".sdEnteredInput");if(e.multiple){let i=document.createElement("option");i.value=d,i.selected=!0,n.appendChild(i)}else n.value=d}function sdSearchAndShowDropdown(e,t,d){let s=t.closest(".searchdown").querySelector(".sdEnteredWrapper"),l=e.values.filter(t=>!(e.hideEntered&&sdEnteredContainsValue(s,t,e.caseSensitive))&&(e.caseSensitive?t.includes(d):t.toLowerCase().includes(d.toLowerCase())));"ASC"===e.sort?l.sort():"DESC"===e.sort&&l.sort().reverse(),0!==e.limit&&(l=l.slice(0,e.limit));let r=t.closest(".searchdown").querySelector(".sdDropdown");r.querySelectorAll("li.sdOption:not(.sdAddOption)").forEach(e=>{e.remove()});let o=!0;for(let a of l){let n=document.createElement("li");n.classList.add("sdOption"),o&&(n.classList.add("sdSelected"),o=!1),n.innerHTML=a,n.addEventListener("click",t=>{""!==a&&sdAddEntered(e,t.target.closest(".searchdown"),t.target.innerHTML,!1)}),r.appendChild(n)}let i=r.querySelector("li.sdAddOption");if(i&&(0===l.length?i.classList.add("sdSelected"):i.classList.remove("sdSelected")),e.values.includes(d))i&&i.classList.add("sdHide");else if(i&&(r.appendChild(i),i.classList.remove("sdHide")),e.addValues){let c=`Click to add <b>"${d}"</b>`;""===d&&(c="Type to enter custom value"),r.querySelector("li.sdAddOption").classList.remove("sdHide"),r.querySelector("li.sdAddOption").innerHTML=c}}function sdEnteredContainsValue(e,t,d){let s=e.getElementsByClassName("sdEntered");for(let l of s)if(d){if(l.innerHTML===t)return!0}else if(l.innerHTML.toLowerCase()===t.toLowerCase())return!0;return!1}function sdGetSelectValues(e){for(var t,d=[],s=e&&e.options,l=0;l<s.length;l++)(t=s[l]).selected&&d.push(t.value||t.text);return d}document.addEventListener("click",e=>{sdLoseFocus(e.target.closest(".searchdown")),e.stopPropagation()});
